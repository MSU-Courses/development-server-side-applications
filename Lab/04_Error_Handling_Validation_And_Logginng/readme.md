# Лабораторная работа №4. Обработка ошибок, валидация и логгирование

> Продолжите разработку приложения из предыдущей лабораторной работы (№3).

## Цель работы

Целью данной лабораторной работы является изучение методов обработки ошибок, валидации данных и логгирования в приложениях на Node.JS с использованием Express.

## Условие

### Шаг 1. Обработка ошибок

1. Реализуйте централизованный обработчик ошибок в вашем приложении Express.
   - Рекомендуется создать пользовательские классы ошибок для различных типов ошибок (например, `NotFoundError`, `ValidationError`, `DatabaseError` и т.д.).
2. Все ошибки должны корректно перехватываться и преобразовываться в унифицированный формат ответа клиенту:
   ```json
   {
     "status": "error",
     "message": "Описание ошибки"
   }
   ```
3. Для асинхронных маршрутов рекомендуется использовать подход, который предотвращает "потерю" ошибок, например, обертка над async-функциями.

### Шаг 2. Валидация данных

1. Используйте библиотеку `express-validator` или `Joi`, добавьте в ваше приложение валидацию входящих данных для всех маршрутов, которые принимают данные от клиента (например, создание или обновление ресурсов).
2. В случае ошибки валидации возвращайте клиенту ответ с кодом состояния `400` и подробным описанием ошибок валидации.
   ```json
   {
     "status": "error",
     "message": "Ошибка валидации данных",
     "errors": [
       {
         "field": "имя_поля",
         "message": "описание ошибки"
       }
     ]
   }
   ```
3. Используйте глобальный обработчик ошибок для обработки ошибок валидации.

### Шаг 3. Логгирование

1. Добавьте в ваше приложение логгирование с использованием библиотеки `winston` или `morgan`.
2. Самостоятельно решите, какие события и ошибки должны логгироваться (например, успешные запросы, ошибки сервера, ошибки валидации и т.д.).
3. Логи должны сохраняться в файл с ротацией (например, с использованием `winston-daily-rotate-file`) или сохранятся в сторонний сервис логгирования (например, Loggly, Papertrail и т.д.).

### Шаг 4. Дополнительные требования. Добавление Sentry

1. Интегрируйте Sentry в ваше приложение для отслеживания ошибок в реальном времени.
2. Настройте отправку ошибок в Sentry из вашего централизованного обработчика ошибок.
3. Убедитесь, что ошибки, связанные с валидацией данных, не отправляются в Sentry, чтобы избежать "засорения" отчетов. Для этого используйте разделение типов ошибок, с помощью пользовательских классов ошибок или других методов.

## Контрольные вопросы

1. Какие преимущества централизованной обработки ошибок в Express?
2. Какие категории логов вы решили вести в системе и чем обусловлен ваш выбор?
3. Какие существуют подходы к валидации данных в Express и какие из них вы использовали?
